from backtesting import Strategy
from backtesting.lib import crossover
import pandas as pd
from ta.momentum import RSIIndicator, StochasticOscillator
from ta.trend import MACD, EMAIndicator, SMAIndicator, ADXIndicator
from ta.volatility import BollingerBands, AverageTrueRange

class CustomStrategy(Strategy):
    def init(self):
        # Create DataFrame for indicators
        close = pd.Series(self.data.Close, index=self.data.index)
        high = pd.Series(self.data.High, index=self.data.index)
        low = pd.Series(self.data.Low, index=self.data.index)
        
        # RSI Indicator
        rsi_ind_0 = RSIIndicator(close=close, window=4)
        self.rsi_0 = self.I(lambda: rsi_ind_0.rsi().values)

    def next(self):
        # Entry conditions
        if self.rsi_0[-1] > 60:
            if not self.position:
                self.buy()

        # Exit conditions
        if self.rsi_0[-1] < 30:
            if self.position:
                self.position.close()
